---
layout: layout.liquid
pagination: 
  data: actions
  size: 1
  alias: action
permalink: "action/{{ action.From + action.Name | slug }}/"
---

<section id="about" class="about-us section">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <div class="section-title">
          <h1>[{{ action.From | actionYear }}] - {{ action.Name }}</h1>
          <p>{{ action.About }}<p>
        </div>
      </div>
    </div>
    <hr />
    <div class="row">
      <ul class="nav nav-tabs nav-fill">
        <li class="nav-item">
          <a class="nav-link active" id="information-tab" data-toggle="tab" href="#information" role="tab" aria-controls="information" aria-selected="true">Informace</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="news-tab" data-toggle="tab" href="#news" role="tab" aria-controls="news" aria-selected="false">Aktuality</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="propositions-tab" data-toggle="tab" href="#propositions" role="tab" aria-controls="propositions" aria-selected="false">Propozice</a>
        </li>
        <li class="nav-item">
          {%- if action.IsEnteringOpened == "1" -%}
            <a class="nav-link" id="applying-tab" data-toggle="tab" href="#applying" role="tab" aria-controls="applying" aria-selected="false">Přihláška</a>
          {%- else -%}
            <a class="nav-link disabled" id="applying-tab" data-toggle="tab" href="#applying" role="tab" aria-controls="applying" aria-selected="false">Přihláška</a>
          {%- endif -%}
        </li>
        <li class="nav-item">
            {%- if action.IsEnteringOpened == "1" -%}
              <a class="nav-link" id="entered-tab" data-toggle="tab" href="#entered" role="tab" aria-controls="entered" aria-selected="false">Přihlášení</a>
            {%- else -%}
              <a class="nav-link disabled" id="entered-tab" data-toggle="tab" href="#entered" role="tab" aria-controls="entered" aria-selected="false">Přihlášení</a>
            {%- endif -%}
        </li>
        <li class="nav-item">
          <a class="nav-link" id="results-tab" data-toggle="tab" href="#results" role="tab" aria-controls="results" aria-selected="false">Výsledky</a>
        </li>
      </ul>
    </div>

    {# =*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=* #}

    <div class="tab-content">
      {# Informations #}
      <div class="tab-pane active" id="information" role="tabpanel" aria-labelledby="information-tab">
        <h4>Informace</h4>
        <hr />
        <div class="container">
          <div class="row">
            <div class="col-6">
              Domovské stránky:
            </div>
            <div class="col-6">
              <a target="_blank" href="{{ action.Url }}">{{ action.Url }}</a>
            </div>
          </div>
          <div class="row">
            <div class="col-6">
              Od - Do:
            </div>
            <div class="col-6">
               {{ action.From | actionDateNoYear }} - {{ action.To | actionDateNoYear }} {{ action.From | actionYear }}
            </div>
          </div>
          <div class="row">
            <div class="col-6">
              Kde:
            </div>
            <div class="col-6">
              {{ action.Where }}
            </div>
          </div>
          <div class="row">
            <div class="col-6">
              Pozice:
            </div>
            <div class="col-6">
              {{ action.Latitude }}N, {{ action.Longitude }}E
            </div>
          </div>
          <div class="row">
            <div class="col-6">
              Přihlašování:
            </div>
            <div class="col-6">
              {%- if action.CustomApplyLink != "" -%}
                <a href="{{ action.CustomApplyLink }}">Zde</a>
              {%- else -%}
                Neuvedeno, vlastní na domovských stránkách - <a href="{{ action.Url }}">{{ action.Url }}</a>
              {%- endif -%}
            </div>
          </div>
          <div class="row">
            <div class="col-2">
              Vypsané závody:
            </div>
            <div class="col-10">
              {%- for race in action.Races -%}
                {%- if race.SerieType == 'MCR_DT' -%}
                  <div class="col color-mcr-dt">{{ race.Name }} [{{ race.Distance }}km][{{ race.Elevation }}m], součástí seriálu MČR Dogtrekking
                  Vypsané kategorie:
                  <ul>
                      {%- for category in race.Categories -%}
                      <li>- {{ category.Name }}</li>
                      {%- endfor -%}
                    </ul>
                  </div>
                {%- elif race.SerieType == 'MCR_DM' -%}
                  <div class="col color-mcr-dm">{{ race.Name }} [{{ race.Distance }}km][{{ race.Elevation }}m], součástí seriálu MČR Dogmaraton
                    Vypsané kategorie:
                      <ul>
                        {%- for category in race.Categories -%}
                        <li>- {{ category.Name }}</li>
                        {%- endfor -%}
                      </ul>
                    </div>
                {%- else -%}
                  <div class="col color-other">{{ race.Name }} [{{ race.Distance }}km][{{ race.Elevation }}m]
                    Vypsané kategorie:
                      <ul>
                        {%- for category in race.Categories -%}
                        <li>- {{ category.Name }}</li>
                        {%- endfor -%}
                      </ul>
                  </div>
                {%- endif -%}
              {%- endfor -%}
            </div>
          </div>
          {%- if action.Latitude > 0.0 -%}
          <div class="row">
            <div class="col-12">
              <div id="mapid"></div>
            </div>
          </div>
		      {%- endif -%}
        </div>
      </div>

      {# News #}
      <div class="tab-pane" id="news" role="tabpanel" aria-labelledby="news-tab">
        <h4>Aktuality</h4>
        <hr />
        <ul>
        {%- for news in actionNews.actionNews | sortedNews -%}
          {%- if news.id_action == action.Id -%}
            <li>{{ news.created }}: {{ news.text | safe }}</li>
          {%- endif -%}
        {%- endfor -%}
        </ul>
      </div>
      
      {# Propositions #}
      <div class="tab-pane" id="propositions" role="tabpanel" aria-labelledby="propositions-tab">
        <h4>Propozice</h4>
        <hr />
        <div class="container">
          <div class="row">
            <div class="col">
              Umístěné na webových stránkách závodu - <a href="{{ action.Url }}">{{ action.Url }}</a>
            </div>
          </div>
        </div>
      </div>
      
      {# Applying #}
      <div class="tab-pane" id="applying" role="tabpanel" aria-labelledby="applying-tab">
        <h4>Přihláška</h4>
        <hr />
        <div class="container">
          <form>
            <div class="row">
              <div class="col-2">
                <h6>Závod</h6>
              </div>
              <div class="col-10">
                <select id="raceRaces" onchange="racesChanged()">
                  <option value="0">--== VYBER ZÁVOD ==--</option>
                  {%- for race in action.Races -%}
                    <option value={{ race.Id }}>{{ race.Name }} [{{ race.Distance }}km][{{ race.Elevation }}m]</option>
                  {%- endfor -%}
                </select>
              </div>
            </div>
            <div class="row">
              <div class="col-2">
                <h6>Kategorie</h6>
              </div>
              <div class="col-10">
                <select id="raceCategories">
                  <option value="0">--== Nejdříve vyber závod ==--</option>
                </select>
              </div>
            </div>
            <hr />
            <div class="row">
              <div class="col-2">
                <h6>Kontaktní údaje</h6>
              </div>
              <div class="col-5">
                <label for="fname">Jméno:</label>
              </div>
              <div class="col-5">
                <label for="lname">Příjmení:</label>
              </div>
            </div>
            <div class="row">
              <div class="col-2">
              </div>
              <div class="col-5">
                <input type="text" autocomplete="given-name" id="fname" />
              </div>
              <div class="col-5">
                <input type="text" autocomplete="family-name" id="lname" />
              </div>
            </div>
            <div class="row">
              <div class="col-2">
              </div>
              <div class="col-5">
                <label for="phone">Telefon</label>
              </div>
              <div class="col-5">
                <label for="mail">E-Mail</label>
              </div>
            </div>
            <div class="row">
              <div class="col-2">
              </div>
              <div class="col-5">
                <input type="tel" autocomplete="tel" id="phone" />
              </div>
              <div class="col-5">
                <input type="mail" autocomplete="email" id="mail" />
              </div>
            </div>
            <div class="row">
              <div class="col-2">
              </div>
              <div class="col-5">
                <label for="address">Adresa</label>
              </div>
              <div class="col-5">
                <label for="city">Město</label>
              </div>
            </div>
            <div class="row">
              <div class="col-2">
              </div>
              <div class="col-5">
                <input type="text" autocomplete="street-address" id="address" />
              </div>
              <div class="col-5">
                <input type="text" autocomplete="address-level2" id="city" />
              </div>
            </div>
            <div class="row">
              <div class="col-2">
                <h6>Datum narození</h6>
              </div>
              <div class="col-10">
                <div class="container">
                  <div class="row">
                    <div class="col-4">Den:</div>
                    <div class="col-4">Měsíc:</div>
                    <div class="col-4">Rok:</div>
                  </div>
                  <div class="row">
                    <div class="col-4"><input type="number" min="1" max="31" value="1" autocomplete="bday-day" id="bday" /></div>
                    <div class="col-4"><input type="number" min="1" max="12" value="1" autocomplete="bday-month" id="bmonth" /></div>
                    <div class="col-4"><input type="number" min="1922" max="2022" value="2000" autocomplete="bday-year" id="byear" /></div>
                  </div>
                </div>
              </div>
            </div>
            <hr />
            <div class="row">
              <div class="col-2">
                <h6>Psi</h6>
              </div>
              <div class="col-10">
                <div class="container">
                  <div class="row">
                    <div class="col-4">
                      <label for="dog_name">Jméno psa</label>
                    </div>
                    <div class="col-4">
                      <label for="dog_pedigree">Plemeno</label>
                    </div>
                    <div class="col-4">
                      <label for="dog_chip">Číslo čipu</label>
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-4">
                      <input type="text" id="dog_name" />
                    </div>
                    <div class="col-4">
                      <input type="text" id="dog_pedigree" />
                    </div>
                    <div class="col-4">
                      <input type="text" id="dog_chip" />
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-8">
                    </div>
                    <div class="col-4">
                      <button type="button" class="btn btn-secondary" onclick="AddDog()">Přidej psa</button>
                    </div>
                  </div>
                  <hr />
                  <div class="row">
                    <div class="col">
                      <b><i>Evidovaní psi</i></b>
                      <table id="EntryRegistratedDogs">
                        <thead>
                          <tr>
                            <th>Čip</th><th>Jméno</th><th>Plemeno</th>
                          </tr>
                        </thead>
                        <tbody>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <hr />
            <div class="row">
              <div class="col-2">
                <h6>Výběr jídla</h6>
              </div>
              <div class="col-10">
                <div class="container">
                  <table>
                    <thead>
                    <tr>
                      <th>Den</th><th>Jídlo</th><th>Cena</th><th>Počet</th>
                    </tr>
                    </thead>
                    <tbody>
                      {%- for food in action.FoodsSelection | orderByDayPart -%}
                        <tr>
                          <td>{{ food.day_part | translateDayPart }}</td>
                          <td>{{ food.food }}</td>
                          <td>{{ food.price }}</td>
                          <td><input type="number" 
                                     value="0" 
                                     min="0" 
                                     onchange="foodOrderUpdated({{ action.Id }}, {{ food.id }}, {{ food.price }}, this.value)" /></td>
                        </tr>
                      {%- endfor -%}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
            <hr />
            <div class="row">
              <div class="col-9">
              </div>
              <div class="col-3">
                <button type="button" class="btn btn-primary" onclick="sendEntryRegistration()">Odeslat</button>
              </div>
            </div>
          </form>
        </div>
      </div>

      {# Entered #}
      <div class="tab-pane" id="entered" role="tabpanel" aria-labelledby="entered-tab">
        <h4>Přihlášení</h4>
        <hr />
        <div class="container">
          <div class="row">
            <div class="col">
              <h3>Bude doplněno co nejdříve, pracujeme na tom ...</h3>
            </div>
          </div>
        </div>
      </div>

      {# Results #}
      <div class="tab-pane" id="results" role="tabpanel" aria-labelledby="results-tab">
        <h4>Výsledky</h4>
        <hr />
        <div class="container">
        {%- for race in action.Races -%}
          <div class="row">
          {%- for category in race.Categories -%}
            <div class="col-lg-6 col-12">
            {%- if race.SerieType == 'MCR_DT' -%}
              <h4><div class="color-mcr-dt">{{ race.Name }} - {{ category.Name }}</div></h4>
            {%- elif race.SerieType == 'MCR_DM' -%}
              <h4><div class="color-mcr-dm">{{ race.Name }} - {{ category.Name }}</div></h4>
            {%- else -%}
              <h4><div class="color-other">{{ race.Name }} - {{ category.Name }}</div></h4>
            {%- endif -%}
              <table class="sortedTable add-margin-bottom" id="{{ race.Name + category.Name | slug }}">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Příjmení, jméno</th>
                    <th>Start</th>
                    <th>Cíl</th>
                    <th>Čas</th>
                  </tr>
                </thead>
                <tbody>
                {%- for raceResults in action.Results.Races -%}
                 {%- for categoryResults in raceResults.Categories -%}
                  {%- if raceResults.Name == race.Name -%}
                   {%- if categoryResults.Name == category.Name -%}
                    {%- for competitor in categoryResults.Competitors -%}
                      <tr>
                      {%- if competitor.Order == 0 -%}
                        <td data-order="99999999"></td>
                      {%- else -%}
                        <td data-order="{{ competitor.Order }}">{{ competitor.Order }}</td>
                      {%- endif -%}
                        <td data-order="{{ competitor.Surname }}, {{ competitor.Name }}">
                          <a href="/Zavodnik/{{ competitor.Id }}/index.html">{{ competitor.Surname }}, {{ competitor.Name }}</a>
                        </td>
                        <td data-order="{{ competitor.Start }}">{{ competitor.Start | wdTime }}</td>
                        <td data-order="{{ competitor.Finish }}">{{ competitor.Finish | wdTime }}</td>
                        <td data-order="{{ competitor.Time }}">{{ competitor.Time | simpleTime }}</td>
                      </tr>
                    {%- endfor -%} <!-- competitor -->
                   {%- endif -%} <!-- category.Name -->
                  {%- endif -%} <!-- result.Name -->
                 {%- endfor -%} <!-- catogory -->
                {%- endfor -%} <!-- race -->
                </tbody>
              </table>
            </div>
          {%- endfor -%} {# Category #}
          </div>
        {%- endfor -%} {# race #}
        </div> {# container #}
      </div>
    </div>
  </div>
</section>

<a href="/Terminovka/{{ action.From | firstFour }}/">Zpět na všechny akce</a>

<script>
  var preparingEntryDogs = [];
  {# 
    let dogSample = {
      chip = "987654321",
      name = "adolfek",
      pedigree = "Čistokrevný smrad jeden kousavý"
    }; 
  #}
  
  var preparingEntryFood = [];
  {# 
    let foodSample = {
        id = 51,
        price = 0,
        count = 2,
    }; 
  #}

  var preparingEntryTShirts = [];
  {# 
    let tshirtSample = {
      id_type: 0,
      size: "L",
      color: "red",
      count: 10
    }; 
  #}


  var mapmargin = 50;
  let height = 0;

  function resize(){
    if(window.innerWidth >= 980) {
      height = window.innerHeight - mapmargin; 
      document.getElementById('mapid').style.marginTop = 50;
    }
	else {
      height = window.innerHeight - (mapmargin+12);
      document.getElementById('mapid').style.marginTop = -21;
    }

    document.getElementById('mapid').style.height = "" + height / 2 + "px";
	  document.getElementById('mapid').style.width = "" + height / 6 * 3 + "px";
  }

  window.onresize = resize;

  resize();
  
  
  var mymap = L.map('mapid').setView([{{ action.Latitude }}, {{ action.Longitude }}], 11);
  var marker = L.marker([{{ action.Latitude }} , {{ action.Longitude }}], { title: "Zde" }).addTo(mymap);
  L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
    maxZoom: 18,
    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, ' +
                 'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
    id: 'mapbox/streets-v11',
    tileSize: 512,
    zoomOffset: -1
  }).addTo(mymap);

  function foodOrderUpdated(idAction, idFood, price, count) {
    let updatedFood = preparingEntryFood.find(x => x.id === idFood);
    
    if (typeof(updatedFood) !== "undefined" && updatedFood !== null)
      updatedFood.count = count;
    else
      preparingEntryFood.push({ id: idFood, price: price, count: count });
  }

  function AddDog() {
    let chipEle = document.getElementById("dog_chip");
    let nameEle = document.getElementById("dog_name");
    let pedigreeEle = document.getElementById("dog_pedigree");
    let tableEle = document.getElementById("EntryRegistratedDogs");

    preparingEntryDogs.push({ name: nameEle.value, chip: chipEle.value, pedigree: pedigreeEle.value });


    let row = tableEle.insertRow(-1);


    let cell = row.insertCell(-1);
    cell.innerText = chipEle.value;

    cell = row.insertCell(-1);
    cell.innerText = nameEle.value;

    cell = row.insertCell(-1);
    cell.innerText = pedigreeEle.value;


    chipEle.value = "";
    nameEle.value = "";
    pedigreeEle.value = "";
  }

  function racesChanged() {
    var value = document.getElementById("raceRaces").value;
    var categoriesSelect = document.getElementById("raceCategories");

    let races = [];
    {%- for race in action.Races -%}
    {
      let race = {};
      race.Id = "{{ race.Id }}";
      race.Name = "{{ race.Name }}";
      
      race.Categories = [];

      {%- for catg in race.Categories -%}
        {
          let category = {};

          category.Id = "{{ catg.Id }}";
          category.Name = "{{ catg.Name }}";

          race.Categories.push(category);
        }
      {%- endfor -%}

      races.push(race);
    }
    {%- endfor -%}

    races.forEach(race => {
      if (race.Id == value) {
        var str = ""
  
        for (let i = 0; i < race.Categories.length; i++) {
          str += "<option value='" + race.Categories[i].Id + "'>" + race.Categories[i].Name + "</option>"
        }
        categoriesSelect.innerHTML = str;
        $('#raceCategories').niceSelect('update');
      }
    });
  };

  function dateToYMD(date) {
    var d = date.getDate();
    var m = date.getMonth() + 1; //Month from 0 to 11
    var y = date.getFullYear();

    return '' + y + '-' + (m<=9 ? '0' + m : m) + '-' + (d <= 9 ? '0' + d : d);
  }

  function sendEntryRegistration() {
    let bday = document.getElementById("bday").value;
    let bmonth = document.getElementById("bmonth").value;
    let byear = document.getElementById("byear").value;
    let birthday = '' + byear + '-' + (bmonth<=9 ? '0' + bmonth : bmonth) + '-' + (bday <= 9 ? '0' + bday : bday);

    let entry = {
      action_id: {{ action.Id }},
      race_id: document.getElementById("raceRaces").value,
      category_id: document.getElementById("raceCategories").value,
      name: document.getElementById("fname").value,
      surname: document.getElementById("lname").value,
      phone: document.getElementById("phone").value,
      email: document.getElementById("mail").value,
      birthday: birthday,
      street: document.getElementById("address").value,
      city: document.getElementById("city").value,
      about: document.getElementById("about").value,
      dogs: preparingEntryDogs,
      tshirts: preparingEntryTShirts,
      foods: preparingEntryFood
    };

    let obj = {
      method: 'POST',
      headers: {
        'Accept': 'application/json',
        'Content-Type': 'application/json',
        'Host': 'www.dogtrekking.cz',
        'Origin': 'localhost'
      },
      body: JSON.stringify(entry)
  };

  fetch(`https://rest.dogtrekking.cz/entries/add`, obj)
  .then(response => response.json())
  .then(json => {
    console.log(json);

    if (typeof(json.entry_id) !== "undefined" && json.entry_id !== null && json.entry_id > 0) {
        alert("OK, přihláška prošla, za chvíli by Ti měl přijít mail o registraci. Pokud nedojde, prosím, kontaktuj nás");
        window.location.reload();
    }
    else {
        alert("Přihláška nebyla přijata, prosíme, ještě jednou zkontroluj, zda jsi vše vyplnil(a) správně, pokud jsi si jist(a), prosím, kontaktuj nás");
    }
  });
}
</script>